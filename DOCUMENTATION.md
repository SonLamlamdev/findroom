Changelog 1 (13:55):

(Save this block for future reference)

Issue: Backend returned 400 "Please add at least 1 image" despite frontend sending files. Root Cause:

The project uses multer-storage-cloudinary middleware. This middleware automatically uploads files to Cloudinary during the request parsing phase.

The Controller (listings.js) attempted to call a function uploadToCloudinary inside the route handler to upload the files again.

This function did not exist in the imported middleware, causing the variable processedFiles to default to [] (empty), triggering the validation error.

Resolution:

Modified backend/routes/listings.js:

Removed the redundant/broken uploadToCloudinary manual call.

Implemented getMediaFromFiles helper function locally in the file.

Updated POST and PUT routes to access req.files directly. req.files contains the Cloudinary metadata (specifically file.path which holds the secure URL) generated by the middleware.

Logic now correctly separates images and videos based on mimetype and saves the Cloudinary URLs to MongoDB.


Changelog (14:05):
1. frontend/src/utils/imageHelper.ts

Fix: Added logic to handle paths that are missing a leading slash or contain Windows backslashes (\).

Fix: Added specific logic to preserve Cloudinary URLs even if they don't start with http (though rare).

Improvement: If a path is local (e.g., image.jpg), it now correctly prepends /uploads/ and the backend URL (e.g., http://localhost:5000/uploads/image.jpg) to prevent 404s caused by missing slashes (e.g. http://localhost:5000image.jpg).

2. frontend/src/pages/ListingDetail.tsx

Fix: Added onError={handleImageError} to the main image and thumbnail <img> tags.

Improvement: If an image link is broken (404), it now dynamically swaps the source to a "Image Not Found" placeholder, preventing the broken file icon/gray box from ruining the UI.